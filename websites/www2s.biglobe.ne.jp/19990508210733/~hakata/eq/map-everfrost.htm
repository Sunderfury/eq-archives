#!/usr/local/bin/perl
#
# 直接アクセスされては困るページ制限(参照制限) v1.00
# (c)rescue@ask.ne.jp

#----------------------------------------------------------------------------------------
#ここに設定したＵＲＬを「含む」ＵＲＬのページからリンククリックしてこのファイルに
#アクセスされないと表示されません.
#
#(参考)他からの直接リンク防止のみならば、あなたの同サーバ内のホームページの中のどのページからも
#アクセスできるようにするには、あなたのホームページを示す一番短いＵＲＬ記述を設定しておきます.
#例：http://www.home.page/~user/
#
#(参考)特定のページからのクリックアクセス以外はすべて拒否するには、そのページのＵＲＬを
#そのまま記述します.
#例：http://www.home.page/~user/where/sample.html
#----------------------------------------------------------------------------------------

$ref_url = 'http://www2s.biglobe.ne.jp/~hakata/eq/';

#----------------------------------------------------------------------------------------
#あるページ(HTML)をこの参照制限したい場合は、そのファイルの冒頭にこのファイルの__END__以上を
#そのままコピーして挿入し、ファイル名の拡張子を.cgiに変更して実行権(755)を与えます.
#----------------------------------------------------------------------------------------

print "Content-type: text/html\n\n";

#どのページにあるリンクをクリックしたかを調査し、そのＵＲＬを得る.
$ref = $ENV{'HTTP_REFERER'};
$ref =~ tr/+/ /;
$ref =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack("C", hex($1))/eg;

if (!($ref =~ /$ref_url/i)) { &error; }

while (<DATA>) { print; }
exit;

sub error {

#設定した条件に合わないアクセスを検知したらこのメッセージを表示する(あたかもページが無いような表示)
print <<'EOF';
<HTML><HEAD><TITLE>404 File Not Found</TITLE></HEAD>
<BODY><H1>404 File Not Found !?</H1>
The requested object does not exist on this server. The link you followed is either outdated, inaccurate, or the server has been instructed not to let you have it. 
</BODY></HTML>
EOF
exit;
}

#設定した条件に合えば__END__より下をそのままＨＴＭＬとして表示する
__END__<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<META name="GENERATOR" content="IBM HomePage Builder 2000  for Windows">
<TITLE></TITLE>
</HEAD>
<BODY>
<H1 align="center">Map of Everfrost peak</H1>
<P align="center"><IMG src="image/map-everfrost.jpg" width="667" height="563" border="0">
</P>
<P>バーバリアンの故郷であるHalasの南に広がる凍った渓谷と東に広がる凍てついた凍土で構成される白い世界。<BR>
渓谷内ではIce GoblnやGnoleの最弱のザコどもがうようよしており、Ｌｖ５までの経験稼ぎにはもってこい。また、こいつらはたまにbackpackを落とすことがある。<BR>
売れば３gpになるし、戦利品を入れておくためにも是非手に入れておきたい（買えば６ｇｐするのだ！）<BR>
渓谷を越えて南西部には悪名高いBlackBallowのダンジョンがある。ここはGnoleどもの本拠地で、それこそウジャウジャいる。最低でもＬｖ５は無いとその身をミンチにされてしまうことだろう。ダンジョン突入までにはＬｖ６にはしておきたい。ここのダンジョンの入り口にはGnole
Guard（Lv5）がたまにいるので要注意。また、洞窟への通路は限りなく暗く、カンテラが絶対に必要。<BR>
変わって東の永久凍土地帯だが、ここにはIce
Orc（戦士と魔法使い）が出現し、こいつはかなり好戦的なので要注意だ。他にもSeltonやマンモス、白熊（強いバージョン）、雪ヒョウ、Ice
Goblin Scout（これはザコだが）、白蜘蛛などが出現する。東の端には未踏の地である巨人達の城がある。こいつらは至って凶暴で、その一撃は８０〜１２０のダメージにもなる。南北に走る凍った川にはいくつか穴があり、そこから水の中（氷の下）に行くことが可能（おそらく、水中を伝ってしか行けない場所があるのでは？）<BR>
伝説の魔法使いが地下に研究施設を建設したという伝説が残っており、ミステリアスな巨人文明の遺跡群とあわせてミステリアスな地帯だ。経験を稼ぐなら、ガードポイントからあまり離れないことと、ガードポイントの方向を忘れないことが重要だ。<BR>
</P>
</BODY>
</HTML>
