<h1>View Source: /logd/mail.php</h1><a href='#source'>Click here for the source,</a> OR<br><b>Other files that you may wish to view the source of:</b><ul><li><a href='source.php?url=/logd/about.php'>about.php</a></li>
<li><a href='source.php?url=/logd/armor.php'>armor.php</a></li>
<li><a href='source.php?url=/logd/armoreditor.php'>armoreditor.php</a></li>
<li><a href='source.php?url=/logd/badnav.php'>badnav.php</a></li>
<li><a href='source.php?url=/logd/bank.php'>bank.php</a></li>
<li><a href='source.php?url=/logd/battle.php'>battle.php</a></li>
<li><a href='source.php?url=/logd/bio.php'>bio.php</a></li>
<li><a href='source.php?url=/logd/common.php'>common.php</a></li>
<li><a href='source.php?url=/logd/configuration.php'>configuration.php</a></li>
<li><a href='source.php?url=/logd/connector.php'>connector.php</a></li>
<li><a href='source.php?url=/logd/create.php'>create.php</a></li>
<li><a href='source.php?url=/logd/creatures.php'>creatures.php</a></li>
<li>dbconnect.php &#151; this file cannot be viewed: it contains sensitive information specific to this installation.</li>
<li><a href='source.php?url=/logd/dbwrapper.php'>dbwrapper.php</a></li>
<li><a href='source.php?url=/logd/donators.php'>donators.php</a></li>
<li>dragon.php &#151; this file cannot be viewed: If you want to read the dragon script, I suggest you do so by defeating it!</li>
<li><a href='source.php?url=/logd/forest.php'>forest.php</a></li>
<li><a href='source.php?url=/logd/graveyard.php'>graveyard.php</a></li>
<li><a href='source.php?url=/logd/gypsy.php'>gypsy.php</a></li>
<li><a href='source.php?url=/logd/healer.php'>healer.php</a></li>
<li><a href='source.php?url=/logd/hof.php'>hof.php</a></li>
<li><a href='source.php?url=/logd/index.php'>index.php</a></li>
<li><a href='source.php?url=/logd/inn.php'>inn.php</a></li>
<li><a href='source.php?url=/logd/list.php'>list.php</a></li>
<li><a href='source.php?url=/logd/logdnet.php'>logdnet.php</a></li>
<li><a href='source.php?url=/logd/login.php'>login.php</a></li>
<li><a href='source.php?url=/logd/mail.php'>mail.php</a></li>
<li><a href='source.php?url=/logd/motd.php'>motd.php</a></li>
<li><a href='source.php?url=/logd/newday.php'>newday.php</a></li>
<li><a href='source.php?url=/logd/news.php'>news.php</a></li>
<li><a href='source.php?url=/logd/petition.php'>petition.php</a></li>
<li><a href='source.php?url=/logd/prefs.php'>prefs.php</a></li>
<li><a href='source.php?url=/logd/pvp.php'>pvp.php</a></li>
<li><a href='source.php?url=/logd/referers.php'>referers.php</a></li>
<li><a href='source.php?url=/logd/shades.php'>shades.php</a></li>
<li><a href='source.php?url=/logd/source.php'>source.php</a></li>
<li><a href='source.php?url=/logd/stables.php'>stables.php</a></li>
<li><a href='source.php?url=/logd/stats.php'>stats.php</a></li>
<li><a href='source.php?url=/logd/superuser.php'>superuser.php</a></li>
<li><a href='source.php?url=/logd/taunt.php'>taunt.php</a></li>
<li><a href='source.php?url=/logd/train.php'>train.php</a></li>
<li><a href='source.php?url=/logd/translator.php'>translator.php</a></li>
<li><a href='source.php?url=/logd/translator_de.php'>translator_de.php</a></li>
<li><a href='source.php?url=/logd/translator_dk.php'>translator_dk.php</a></li>
<li><a href='source.php?url=/logd/translator_en.php'>translator_en.php</a></li>
<li><a href='source.php?url=/logd/translator_es.php'>translator_es.php</a></li>
<li><a href='source.php?url=/logd/translator_fr.php'>translator_fr.php</a></li>
<li><a href='source.php?url=/logd/user.php'>user.php</a></li>
<li><a href='source.php?url=/logd/viewpetition.php'>viewpetition.php</a></li>
<li><a href='source.php?url=/logd/village.php'>village.php</a></li>
<li><a href='source.php?url=/logd/weaponeditor.php'>weaponeditor.php</a></li>
<li><a href='source.php?url=/logd/weapons.php'>weapons.php</a></li>
<li><a href='source.php?url=/logd/special/audrey.php'>special/audrey.php</a></li>
<li><a href='source.php?url=/logd/special/darkhorse.php'>special/darkhorse.php</a></li>
<li><a href='source.php?url=/logd/special/distress.php'>special/distress.php</a></li>
<li><a href='source.php?url=/logd/special/fairy1.php'>special/fairy1.php</a></li>
<li><a href='source.php?url=/logd/special/findgem.php'>special/findgem.php</a></li>
<li><a href='source.php?url=/logd/special/findgold.php'>special/findgold.php</a></li>
<li><a href='source.php?url=/logd/special/glowingstream.php'>special/glowingstream.php</a></li>
<li><a href='source.php?url=/logd/special/grassyfield.php'>special/grassyfield.php</a></li>
<li><a href='source.php?url=/logd/special/oldmanbet.php'>special/oldmanbet.php</a></li>
<li><a href='source.php?url=/logd/special/oldmanpretty.php'>special/oldmanpretty.php</a></li>
<li><a href='source.php?url=/logd/special/oldmantown.php'>special/oldmantown.php</a></li>
<li><a href='source.php?url=/logd/special/oldmanugly.php'>special/oldmanugly.php</a></li>
<li><a href='source.php?url=/logd/special/riddles.php'>special/riddles.php</a></li>
<li><a href='source.php?url=/logd/special/skillmaster.php'>special/skillmaster.php</a></li>
</ul><h1><a name='source'>Source of: /logd/mail.php</a></h1><code><font color="#000000">
<font color="#0000BB">&lt;?<br /></font><font color="#007700">require_once </font><font color="#DD0000">"common.php"</font><font color="#007700">;<br /></font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"DELETE FROM mail WHERE sent&lt;'"</font><font color="#007700">.</font><font color="#0000BB">date</font><font color="#007700">(</font><font color="#DD0000">"Y-m-d H:i:s"</font><font color="#007700">,</font><font color="#0000BB">strtotime</font><font color="#007700">(</font><font color="#DD0000">"-"</font><font color="#007700">.</font><font color="#0000BB">getsetting</font><font color="#007700">(</font><font color="#DD0000">"oldmail"</font><font color="#007700">,</font><font color="#0000BB">14</font><font color="#007700">).</font><font color="#DD0000">"days"</font><font color="#007700">)).</font><font color="#DD0000">"'"</font><font color="#007700">;<br /></font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br /><br /><br />if(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">"del"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"DELETE FROM mail WHERE msgto='"</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"' AND messageid='$_GET</font><font color="#007700">[</font><font color="#DD0000">id</font><font color="#007700">]</font><font color="#DD0000">'"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">header</font><font color="#007700">(</font><font color="#DD0000">"Location: mail.php"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();&nbsp;&nbsp;&nbsp;&nbsp;<br />}elseif(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">"process"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;if (!</font><font color="#0000BB">is_array</font><font color="#007700">(</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#DD0000">'msg'</font><font color="#007700">]) || </font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#DD0000">'msg'</font><font color="#007700">])&lt;</font><font color="#0000BB">1</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#DD0000">'message'</font><font color="#007700">] = </font><font color="#DD0000">"`\$`bYou cannot delete zero messages!&nbsp;&nbsp;What does this mean?&nbsp;&nbsp;You pressed \"Delete Checked\" but there are no messages checked!&nbsp;&nbsp;What sort of world is this that people press buttons that have no meaning?!?`b`0"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">header</font><font color="#007700">(</font><font color="#DD0000">"Location: mail.php"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"DELETE FROM mail WHERE msgto='"</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"' AND messageid IN ('"</font><font color="#007700">.</font><font color="#0000BB">join</font><font color="#007700">(</font><font color="#DD0000">"','"</font><font color="#007700">,</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">msg</font><font color="#007700">]).</font><font color="#DD0000">"')"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">header</font><font color="#007700">(</font><font color="#DD0000">"Location: mail.php"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></font><font color="#0000BB">popup_header</font><font color="#007700">(</font><font color="#DD0000">"Ye Olde Poste Office"</font><font color="#007700">);<br /><br /></font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;a href='mail.php' class='motd'&gt;Inbox&lt;/a&gt;&lt;a href='mail.php?op=address' class='motd'&gt;Write&lt;/a&gt;`n`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />if (</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`b`iMail Box`i`b"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#DD0000">'message'</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#DD0000">'message'</font><font color="#007700">]=</font><font color="#DD0000">""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT subject,messageid,accounts.name,msgfrom,seen,sent FROM mail LEFT JOIN accounts ON accounts.acctid=mail.msgfrom WHERE msgto=\""</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"\" ORDER BY seen,sent"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)&gt;</font><font color="#0000BB">0</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;form action='mail.php?op=process' method='POST'&gt;&lt;table&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">&lt;</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);</font><font color="#0000BB">$i</font><font color="#007700">++){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((int)</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">msgfrom</font><font color="#007700">]==</font><font color="#0000BB">0</font><font color="#007700">) </font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">name</font><font color="#007700">]=</font><font color="#DD0000">"`i`^System`0`i"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;tr&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;td nowrap&gt;&lt;input id='checkbox$i' type='checkbox' name='msg</font><font color="#007700">[]</font><font color="#DD0000">' value='$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">'&gt;&lt;img src='images/"</font><font color="#007700">.(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">seen</font><font color="#007700">]?</font><font color="#DD0000">"old"</font><font color="#007700">:</font><font color="#DD0000">"new"</font><font color="#007700">).</font><font color="#DD0000">"scroll.GIF' width='16' height='16' alt='"</font><font color="#007700">.(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">seen</font><font color="#007700">]?</font><font color="#DD0000">"Old"</font><font color="#007700">:</font><font color="#DD0000">"New"</font><font color="#007700">).</font><font color="#DD0000">"'&gt;&lt;/td&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;td&gt;&lt;a href='mail.php?op=read&amp;id=$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href='mail.php?op=read&amp;id=$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">name</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href='mail.php?op=read&amp;id=$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">'&gt;"</font><font color="#007700">.</font><font color="#0000BB">date</font><font color="#007700">(</font><font color="#DD0000">"M d, h:i a"</font><font color="#007700">,</font><font color="#0000BB">strtotime</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">sent</font><font color="#007700">])).</font><font color="#DD0000">"&lt;/a&gt;&lt;/td&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/tr&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/table&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$out</font><font color="#007700">=</font><font color="#DD0000">"&lt;input type='button' value='Check All' onClick='"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">$i</font><font color="#007700">-</font><font color="#0000BB">1</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">&gt;=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">--){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$out</font><font color="#007700">.=</font><font color="#DD0000">"document.getElementById(</font><font color="#007700">\"</font><font color="#DD0000">checkbox$i</font><font color="#007700">\"</font><font color="#DD0000">).checked=true;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$out</font><font color="#007700">.=</font><font color="#DD0000">"'&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">$out</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;input type='submit' class='button' value='Delete Checked'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/form&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`iAww, you have no mail, how sad.`i"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`n`n`iYou have "</font><font color="#007700">.</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">).</font><font color="#DD0000">" messages in your inbox.`nYou may only have "</font><font color="#007700">.</font><font color="#0000BB">getsetting</font><font color="#007700">(</font><font color="#DD0000">'inboxlimit'</font><font color="#007700">,</font><font color="#0000BB">50</font><font color="#007700">).</font><font color="#DD0000">" messages in your inbox.&nbsp;&nbsp;`nMessages are deleted after "</font><font color="#007700">.</font><font color="#0000BB">getsetting</font><font color="#007700">(</font><font color="#DD0000">"oldmail"</font><font color="#007700">,</font><font color="#0000BB">14</font><font color="#007700">).</font><font color="#DD0000">" days"</font><font color="#007700">);<br />}elseif (</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">"read"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"UPDATE mail SET seen=1 WHERE&nbsp;&nbsp;msgto=\""</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"\" AND messageid=\""</font><font color="#007700">.</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">id</font><font color="#007700">].</font><font color="#DD0000">"\""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT mail.*,accounts.name FROM mail LEFT JOIN accounts ON accounts.acctid=mail.msgfrom WHERE msgto=\""</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"\" AND messageid=\""</font><font color="#007700">.</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">id</font><font color="#007700">].</font><font color="#DD0000">"\""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">) or die(</font><font color="#0000BB">db_error</font><font color="#007700">(</font><font color="#0000BB">LINK</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)&gt;</font><font color="#0000BB">0</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">msgfrom</font><font color="#007700">]==</font><font color="#DD0000">""</font><font color="#007700">) </font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">name</font><font color="#007700">]=</font><font color="#DD0000">"`iSystem`i"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`b`2From:`b `^$row</font><font color="#007700">[</font><font color="#DD0000">name</font><font color="#007700">]</font><font color="#DD0000">`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`b`2Subject:`b `^$row</font><font color="#007700">[</font><font color="#DD0000">subject</font><font color="#007700">]</font><font color="#DD0000">`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;img src='images/uscroll.GIF' width='182' height='11' alt='' align='center'&gt;`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">str_replace</font><font color="#007700">(</font><font color="#DD0000">"\n"</font><font color="#007700">,</font><font color="#DD0000">"`n"</font><font color="#007700">,</font><font color="#DD0000">"$row</font><font color="#007700">[</font><font color="#DD0000">body</font><font color="#007700">]</font><font color="#DD0000">"</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`n&lt;img src='images/lscroll.GIF' width='182' height='11' alt='' align='center'&gt;`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;a href='mail.php?op=write&amp;replyto=$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">' class='motd'&gt;Reply&lt;/a&gt;&lt;a href='mail.php?op=del&amp;id=$row</font><font color="#007700">[</font><font color="#DD0000">messageid</font><font color="#007700">]</font><font color="#DD0000">' class='motd'&gt;Del&lt;/a&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"Eek, no such message was found!"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}elseif(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'op'</font><font color="#007700">]==</font><font color="#DD0000">"address"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;form action='mail.php?op=write' method='POST'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`b`2Address:`b`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`2T&lt;u&gt;o&lt;/u&gt;: &lt;input name='to' accesskey='o'&gt; &lt;input type='submit' value='Search'&gt;&lt;/form&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />}elseif(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">"write"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$subject</font><font color="#007700">=</font><font color="#DD0000">""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$body</font><font color="#007700">=</font><font color="#DD0000">""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;form action='mail.php?op=send' method='POST'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">replyto</font><font color="#007700">]!=</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT mail.body,mail.subject,accounts.login,accounts.name FROM mail LEFT JOIN accounts ON accounts.acctid=mail.msgfrom WHERE msgto=\""</font><font color="#007700">.</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"\" AND messageid=\""</font><font color="#007700">.</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">replyto</font><font color="#007700">].</font><font color="#DD0000">"\""</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">) or die(</font><font color="#0000BB">db_error</font><font color="#007700">(</font><font color="#0000BB">LINK</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)&gt;</font><font color="#0000BB">0</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">login</font><font color="#007700">]==</font><font color="#DD0000">""</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"You cannot reply to a system message.`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row</font><font color="#007700">=array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"Eek, no such message was found!`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">to</font><font color="#007700">]!=</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT login,name FROM accounts WHERE login=</font><font color="#007700">\"</font><font color="#DD0000">$_GET</font><font color="#007700">[</font><font color="#DD0000">to</font><font color="#007700">]\"</font><font color="#DD0000">"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">) or die(</font><font color="#0000BB">db_error</font><font color="#007700">(</font><font color="#0000BB">LINK</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)&gt;</font><font color="#0000BB">0</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"Could not find that person.`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">is_array</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">]!=</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$subject</font><font color="#007700">=</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">substr</font><font color="#007700">(</font><font color="#0000BB">$subject</font><font color="#007700">,</font><font color="#0000BB">0</font><font color="#007700">,</font><font color="#0000BB">4</font><font color="#007700">)!=</font><font color="#DD0000">"RE: "</font><font color="#007700">) </font><font color="#0000BB">$subject</font><font color="#007700">=</font><font color="#DD0000">"RE: $subject"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]!=</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$body</font><font color="#007700">=</font><font color="#DD0000">"\n\n---Original Message---\n"</font><font color="#007700">.</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">login</font><font color="#007700">]!=</font><font color="#DD0000">""</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;input type='hidden' name='to' value=\""</font><font color="#007700">.</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">login</font><font color="#007700">]).</font><font color="#DD0000">"\"&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`2To: `^$row</font><font color="#007700">[</font><font color="#DD0000">name</font><font color="#007700">]</font><font color="#DD0000">`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`2To: "</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$string</font><font color="#007700">=</font><font color="#DD0000">"%"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$x</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$x</font><font color="#007700">&lt;</font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#DD0000">'to'</font><font color="#007700">]);</font><font color="#0000BB">$x</font><font color="#007700">++){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$string </font><font color="#007700">.= </font><font color="#0000BB">substr</font><font color="#007700">(</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#DD0000">'to'</font><font color="#007700">],</font><font color="#0000BB">$x</font><font color="#007700">,</font><font color="#0000BB">1</font><font color="#007700">).</font><font color="#DD0000">"%"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT login,name FROM accounts WHERE name LIKE '"</font><font color="#007700">.</font><font color="#0000BB">addslashes</font><font color="#007700">(</font><font color="#0000BB">$string</font><font color="#007700">).</font><font color="#DD0000">"' AND locked=0 ORDER BY login"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)==</font><font color="#0000BB">1</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;input type='hidden' name='to' value=\""</font><font color="#007700">.</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">login</font><font color="#007700">]).</font><font color="#DD0000">"\"&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`^$row</font><font color="#007700">[</font><font color="#DD0000">name</font><font color="#007700">]</font><font color="#DD0000">`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;select name='to'&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">&lt;</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);</font><font color="#0000BB">$i</font><font color="#007700">++){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;option value=\""</font><font color="#007700">.</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">login</font><font color="#007700">]).</font><font color="#DD0000">"\"&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#0000BB">preg_replace</font><font color="#007700">(</font><font color="#DD0000">"/[`]./"</font><font color="#007700">,</font><font color="#DD0000">""</font><font color="#007700">,</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">name</font><font color="#007700">]));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/select&gt;`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`2Subject: &lt;input name='subject' value=\""</font><font color="#007700">.</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">$subject</font><font color="#007700">).</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">stripslashes</font><font color="#007700">(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'subject'</font><font color="#007700">])).</font><font color="#DD0000">"\"&gt;`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"`2Body:`n"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$output</font><font color="#007700">.=</font><font color="#DD0000">"&lt;textarea name='body' class='input' cols='40' rows='9'&gt;"</font><font color="#007700">.</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">$body</font><font color="#007700">).</font><font color="#0000BB">HTMLEntities</font><font color="#007700">(</font><font color="#0000BB">stripslashes</font><font color="#007700">(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'body'</font><font color="#007700">])).</font><font color="#DD0000">"&lt;/textarea&gt;&lt;br&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;input type='submit' class='button' value='Send'&gt;`n"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"&lt;/form&gt;"</font><font color="#007700">,</font><font color="#0000BB">true</font><font color="#007700">);<br />}elseif(</font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#0000BB">op</font><font color="#007700">]==</font><font color="#DD0000">"send"</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT acctid FROM accounts WHERE login='$_POST</font><font color="#007700">[</font><font color="#DD0000">to</font><font color="#007700">]</font><font color="#DD0000">'"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">db_num_rows</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">)&gt;</font><font color="#0000BB">0</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row1 </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sql </font><font color="#007700">= </font><font color="#DD0000">"SELECT count(messageid) AS count FROM mail WHERE msgto='"</font><font color="#007700">.</font><font color="#0000BB">$row1</font><font color="#007700">[</font><font color="#0000BB">acctid</font><font color="#007700">].</font><font color="#DD0000">"' AND seen=0"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$row </font><font color="#007700">= </font><font color="#0000BB">db_fetch_assoc</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$row</font><font color="#007700">[</font><font color="#0000BB">count</font><font color="#007700">]&gt;</font><font color="#0000BB">getsetting</font><font color="#007700">(</font><font color="#DD0000">"inboxlimit"</font><font color="#007700">,</font><font color="#0000BB">50</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"You cannot send that person mail, their mailbox is full!"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">]=</font><font color="#0000BB">str_replace</font><font color="#007700">(</font><font color="#DD0000">"`n"</font><font color="#007700">,</font><font color="#DD0000">""</font><font color="#007700">,</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]=</font><font color="#0000BB">str_replace</font><font color="#007700">(</font><font color="#DD0000">"`n"</font><font color="#007700">,</font><font color="#DD0000">"\n"</font><font color="#007700">,</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]=</font><font color="#0000BB">str_replace</font><font color="#007700">(</font><font color="#DD0000">"\r\n"</font><font color="#007700">,</font><font color="#DD0000">"\n"</font><font color="#007700">,</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]=</font><font color="#0000BB">str_replace</font><font color="#007700">(</font><font color="#DD0000">"\r"</font><font color="#007700">,</font><font color="#DD0000">"\n"</font><font color="#007700">,</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">]=</font><font color="#0000BB">substr</font><font color="#007700">(</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">],</font><font color="#0000BB">0</font><font color="#007700">,(int)</font><font color="#0000BB">getsetting</font><font color="#007700">(</font><font color="#DD0000">"mailsizelimit"</font><font color="#007700">,</font><font color="#0000BB">1024</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">systemmail</font><font color="#007700">(</font><font color="#0000BB">$row1</font><font color="#007700">[</font><font color="#0000BB">acctid</font><font color="#007700">],</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">subject</font><font color="#007700">],</font><font color="#0000BB">$_POST</font><font color="#007700">[</font><font color="#0000BB">body</font><font color="#007700">],</font><font color="#0000BB">$session</font><font color="#007700">[</font><font color="#0000BB">user</font><font color="#007700">][</font><font color="#0000BB">acctid</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql = "INSERT INTO mail (msgfrom,msgto,subject,body,sent) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES (<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$session[user][acctid].",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$row1[acctid].",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$_POST[subject]',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$_POST[body]',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db_query($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"Your message was sent!"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">output</font><font color="#007700">(</font><font color="#DD0000">"Could not find the recipient, please try again."</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></font><font color="#0000BB">popup_footer</font><font color="#007700">();<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code>